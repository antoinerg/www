<!DOCTYPE html>
<html lang='en'>
  <head>
    <!-- <script src='http://localhost:3000/build/plotly.js'></script> -->
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <style>
      html, body {
        margin:0; padding:0;
      }
      #grid {
        display: grid;
        width: 100vw;
        height: 100vh;
        grid-template-columns: 1fr 1fr;
        grid-template-rows: 1fr 1fr;
      }

      #grid > div {
        display:inline-block;
      }

      #loading {
        
      }
    </style>
  </head>
  <body>
    <div id="loading"></div>
    <h1 id="status">Loading</h1>
    <div id="grid">
      <div id="gd1"></div>
      <div id="gd2"></div>
      <div id="gd3"></div><div id="gd4"></div>
    </div>

    <script>
    function draw() {
      var x = []; var u = []; var t = []; var lp_drive_gain = []; var lp_x2 =[]; var n= [];
      var phase = [];
      axios.get('/out.bin',{responseType: 'arraybuffer'})
      .then(function(value) {
        var matrix = new Float64Array(value.data);
        for(var i = 0; i < matrix.length; i++) {
          if(i % 9 === 0) t.push(matrix[i])
          if(i % 9 === 1) x.push(matrix[i])
          if(i % 9 === 2) {
            u.push(matrix[i] / 600E3);

            phase.push(Math.atan(x.slice(-1), u.slice(-1)))
          }
          if(i % 9 === 5) lp_x2.push(Math.sqrt(matrix[i])*Math.sqrt(2));
          if(i % 9 === 6) lp_drive_gain.push(matrix[i])
          if(i % 9 === 7) n.push(matrix[i])
        }
        console.log(matrix.length)


        var p = [
          Plotly.newPlot('gd3',[{name: 'lp_drive_gain', type: 'scattergl', x: t, y: lp_drive_gain}]),
          Plotly.newPlot('gd2',[{name: 'x', type: 'scattergl', x: t, y: x}, {name: 'lp_x2', type: 'scattergl', x: t, y: lp_x2}]),
          Plotly.newPlot('gd1',[{type: 'scattergl', x: x, y: u}], { xaxis: { constrain: 'domain'}})
        ]

        Promise.all(p)
        .then(function() {
          document.getElementById('status').innerText = 'Done';

        })
        .catch(function() {
          document.getElementById('status').innerText = 'Failed'
        })
      })
    }

    draw()

    </script>
  </body>
</html>
